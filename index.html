<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laporan Produksi</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 0; margin: 0; background: #f2f2f2; }
    .tabs { display: flex; background: #007bff; }
    .tabBtn {
      flex: 1; padding: 12px; border: none; background: #007bff; color: white;
      font-weight: bold; cursor: pointer;
    }
    .tabBtn.active { background: #0056b3; }
    .tabContent { display: none; padding: 16px; max-width: 800px; margin: auto; }
    input, textarea, button, select {
      width: 100%; padding: 10px; margin-top: 8px; font-size: 14px;
      border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;
    }
    button { font-weight: bold; border: none; color: white; cursor: pointer; }
    #generateBtn { background: #28a745; }
    #waBtn { background: #25d366; }
    #copyBtn { background: #007bff; }
    pre {
      background: #fff; padding: 12px; border-radius: 5px; border: 1px solid #ccc;
      white-space: pre-wrap; font-family: monospace;
    }
    #notif {
      margin-top: 10px; padding: 8px; border-radius: 5px; font-size: 14px; display: none;
    }
    #notif.sukses { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    #notif.gagal { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    details { background: #fff; margin: 8px 0; padding: 8px; border-radius: 5px; border: 1px solid #ddd; }
    summary { font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>

<!-- ðŸ”¹ Tabs -->
<div class="tabs">
  <button class="tabBtn active" onclick="openTab('shiftTab', this)">Laporan Shift</button>
  <button class="tabBtn" onclick="openTab('line2Tab', this)">Laporan Line 2 & 3</button>
  <button class="tabBtn" onclick="openTab('monitorTab', this)">Monitoring</button>
</div>

<!-- ðŸ”¹ TAB 1: Shift -->
<div id="shiftTab" class="tabContent" style="display:block;">
  <h2>Laporan Shift</h2>
  <input type="date" id="tanggal">
  <label>Pilih Shift:</label>
  <select id="shiftSelect" onchange="updateShiftInput()">
    <option value="">-- Pilih Shift --</option>
    <option value="A">Shift A</option>
    <option value="B">Shift B</option>
    <option value="C">Shift C</option>
    <option value="lain">Lainnya (manual)</option>
  </select>
  <input id="shift" placeholder="Isi shift manual">

  <input id="produk" placeholder="Produk">
  <textarea id="catatan_grinding" placeholder="Catatan Grinding"></textarea>
  <textarea id="catatan_preparation" placeholder="Catatan Preparation"></textarea>
  <textarea id="catatan_finish" placeholder="Catatan Finish Good"></textarea>

  <button id="generateBtn" onclick="generateShift()">Tampilkan & Simpan</button>
  <div id="notif"></div>
  <pre id="output"></pre>
  <button id="waBtn" onclick="kirimWhatsApp()">Kirim WhatsApp</button>
  <button id="copyBtn" onclick="salinLaporan()">Salin</button>

  <h3>ðŸ“‹ Data Tersimpan</h3>
  <label>Filter tanggal:</label>
  <input type="date" id="filterTanggal" onchange="tampilkanLaporanShift()">
  <label>Filter shift:</label>
  <select id="filterShift" onchange="tampilkanLaporanShift()">
    <option value="">Semua</option>
    <option value="A">Shift A</option>
    <option value="B">Shift B</option>
    <option value="C">Shift C</option>
  </select>
  <ul id="laporanList"></ul>
</div>

<!-- ðŸ”¹ TAB 2: Line 2 & 3 -->
<div id="line2Tab" class="tabContent">
  <h2>Laporan Line 2 & 3</h2>
  <input type="date" id="tanggal2">
  <input id="shift2" placeholder="Shift">
  <input id="produk2" placeholder="Produk">
  <textarea id="catatan2" placeholder="Catatan Line 2"></textarea>
  <textarea id="catatan3" placeholder="Catatan Line 3"></textarea>

  <button onclick="generateLine23()">Tampilkan & Simpan</button>
  <pre id="output2"></pre>
</div>

<!-- ðŸ”¹ TAB 3: Monitoring -->
<div id="monitorTab" class="tabContent">
  <h2>Monitoring Semua Data</h2>
  <label>Filter tanggal:</label>
  <input type="date" id="monitorTanggal" onchange="renderMonitor()">
  <div id="monitorOutput"></div>
</div>

<script>
function openTab(tabId, elm) {
  document.querySelectorAll(".tabContent").forEach(tab => tab.style.display="none");
  document.getElementById(tabId).style.display="block";
  document.querySelectorAll(".tabBtn").forEach(btn => btn.classList.remove("active"));
  elm.classList.add("active");
}
function g(id){return document.getElementById(id).value.trim();}
function showNotif(pesan, sukses=true){
  const n=document.getElementById("notif");
  n.textContent=pesan; n.className=sukses?"sukses":"gagal"; n.style.display="block";
  setTimeout(()=>n.style.display="none",3000);
}
function updateShiftInput(){
  const s=document.getElementById("shiftSelect"), i=document.getElementById("shift");
  if(s.value==="lain"){i.style.display="block"; i.value="";} else {i.style.display="none"; i.value=s.value;}
}
function kirimWhatsApp(){const isi=document.getElementById("output").textContent;if(isi)window.open("https://wa.me/?text="+encodeURIComponent(isi),"_blank");}
function salinLaporan(){const isi=document.getElementById("output").textContent;if(isi)navigator.clipboard.writeText(isi).then(()=>showNotif("ðŸ“‹ Laporan disalin",true));}
</script>

<!-- ðŸ”¹ Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCReZ1Hs1p63Sq6DWODvwbKCgpVPUzVKQA",
  authDomain: "laporanharian-d689c.firebaseapp.com",
  databaseURL: "https://laporanharian-d689c-default-rtdb.firebaseio.com",
  projectId: "laporanharian-d689c",
  storageBucket: "laporanharian-d689c.appspot.com",
  messagingSenderId: "161606001787",
  appId: "1:161606001787:web:a2550a1abf208ce188aede",
  measurementId: "G-E9SL4RT4TB"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ðŸ”¹ SHIFT
let dataShift={};
window.generateShift=function(){
  const shift=g("shift")||"-";
  let hasil=`LAPORAN SHIFT ${shift}\nTanggal: ${g("tanggal")}\nProduk: ${g("produk")}\n`;
  if(g("catatan_grinding"))hasil+=`Catatan Grinding: ${g("catatan_grinding")}\n`;
  if(g("catatan_preparation"))hasil+=`Catatan Preparation: ${g("catatan_preparation")}\n`;
  if(g("catatan_finish"))hasil+=`Catatan Finish: ${g("catatan_finish")}\n`;
  document.getElementById("output").textContent=hasil;
  const tanggal=g("tanggal")||"tanpa_tanggal";
  const refDb=ref(db,"laporan_shift/"+tanggal); const newData=push(refDb);
  set(newData,{shift:shift,laporan:hasil,waktu:new Date().toISOString()})
  .then(()=>showNotif("âœ… Laporan shift tersimpan",true))
  .catch(()=>showNotif("âŒ Gagal simpan",false));
}
const refShift=ref(db,"laporan_shift");
onValue(refShift,(snap)=>{dataShift=snap.val()||{}; renderShift(); renderMonitor();});
window.tampilkanLaporanShift=function(){renderShift();}
function renderShift(){
  const fT=document.getElementById("filterTanggal").value;
  const fS=document.getElementById("filterShift").value;
  const list=document.getElementById("laporanList"); list.innerHTML="";
  Object.keys(dataShift).forEach(tgl=>{
    if(fT&&tgl!==fT)return;
    let isi=""; Object.values(dataShift[tgl]).forEach(item=>{
      if(fS&&item.shift!==fS)return;
      isi+=`<li><pre>${item.laporan}</pre><small>Shift: ${item.shift} | ${item.waktu}</small></li>`;
    });
    if(isi){const li=document.createElement("li"); li.innerHTML=`<b>${tgl}</b><ul>${isi}</ul>`; list.appendChild(li);}
  });
}

// ðŸ”¹ LINE 2 & 3
let dataLine23={};
window.generateLine23=function(){
  let hasil=`LAPORAN LINE 2 & 3\nTanggal: ${g("tanggal2")}\nShift: ${g("shift2")}\nProduk: ${g("produk2")}\n`;
  if(g("catatan2"))hasil+=`Catatan Line2: ${g("catatan2")}\n`;
  if(g("catatan3"))hasil+=`Catatan Line3: ${g("catatan3")}\n`;
  document.getElementById("output2").textContent=hasil;
  const tanggal=g("tanggal2")||"tanpa_tanggal";
  const refDb=ref(db,"laporan_line2_3/"+tanggal); const newData=push(refDb);
  set(newData,{shift:g("shift2"),laporan:hasil,waktu:new Date().toISOString()});
}
const refLine23=ref(db,"laporan_line2_3");
onValue(refLine23,(snap)=>{dataLine23=snap.val()||{}; renderMonitor();});

// ðŸ”¹ MONITOR
function renderMonitor(){
  const fT=document.getElementById("monitorTanggal").value;
  const out=document.getElementById("monitorOutput"); out.innerHTML="";
  // shift
  Object.keys(dataShift).forEach(tgl=>{
    if(fT&&tgl!==fT)return;
    Object.values(dataShift[tgl]).forEach(item=>{
      const d=document.createElement("details");
      d.innerHTML=`<summary>Shift | ${tgl} - ${item.shift}</summary><pre>${item.laporan}</pre>`;
      out.appendChild(d);
    });
  });
  // line2&3
  Object.keys(dataLine23).forEach(tgl=>{
    if(fT&&tgl!==fT)return;
    Object.values(dataLine23[tgl]).forEach(item=>{
      const d=document.createElement("details");
      d.innerHTML=`<summary>Line 2&3 | ${tgl} - ${item.shift}</summary><pre>${item.laporan}</pre>`;
      out.appendChild(d);
    });
  });
}
</script>
</body>
</html>
