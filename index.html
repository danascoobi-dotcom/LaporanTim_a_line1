<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laporan Produksi</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 0; margin: 0; background: #f2f2f2; }
    .tabs { display: flex; background: #007bff; }
    .tabBtn {
      flex: 1; padding: 12px; border: none; background: #007bff; color: white;
      font-weight: bold; cursor: pointer;
    }
    .tabBtn.active { background: #0056b3; }
    .tabContent { display: none; padding: 16px; max-width: 900px; margin: auto; }
    input, textarea, button, select {
      width: 100%; padding: 10px; margin-top: 8px; font-size: 14px;
      border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;
    }
    button { font-weight: bold; border: none; color: white; cursor: pointer; margin-top: 8px; }
    #generateBtn { background: #28a745; }
    #waBtn { background: #25d366; }
    #copyBtn { background: #007bff; }
    pre {
      background: #fff; padding: 12px; border-radius: 5px; border: 1px solid #ccc;
      white-space: pre-wrap; font-family: monospace;
    }
    #notif {
      margin-top: 10px; padding: 8px; border-radius: 5px; font-size: 14px; display: none;
    }
    #notif.sukses { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    #notif.gagal { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    details { background: #fff; margin: 8px 0; padding: 8px; border-radius: 5px; border: 1px solid #ddd; }
    summary { font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>

<!-- 🔹 Tabs -->
<div class="tabs">
  <button class="tabBtn active" onclick="openTab('shiftTab', this)">Laporan Shift</button>
  <button class="tabBtn" onclick="openTab('line2Tab', this)">Laporan Line 2 & 3</button>
  <button class="tabBtn" onclick="openTab('monitorTab', this)">Monitoring</button>
</div>

<!-- 🔹 TAB 1: Laporan Shift -->
<div id="shiftTab" class="tabContent" style="display:block;">
  <h2>Laporan Shift</h2>
  <input type="date" id="tanggal">
  <label>Pilih Shift:</label>
  <select id="shiftSelect" onchange="updateShiftInput()">
    <option value="">-- Pilih Shift --</option>
    <option value="A">Shift A</option>
    <option value="B">Shift B</option>
    <option value="C">Shift C</option>
    <option value="lain">Lainnya (manual)</option>
  </select>
  <input id="shift" placeholder="Isi shift manual">

  <input id="produk" placeholder="Produk">

  <h3>GRINDING</h3>
  <input id="psa" placeholder="Ukuran PSA / Partikel">
  <input id="mesh" placeholder="Mesh">
  <input id="mix_a" placeholder="Mix A">
  <input id="mix_b" placeholder="Mix B">
  <input id="silo_a" placeholder="Silo A">
  <input id="silo_b" placeholder="Silo B">
  <textarea id="catatan_grinding" placeholder="Catatan Grinding..."></textarea>

  <h3>PREPARATION</h3>
  <input type="number" id="pulp203" placeholder="Pulp Tangki 203 (set)">
  <input type="number" id="pulp204" placeholder="Pulp Tangki 204 (set)">
  <input type="number" id="pulp205" placeholder="Pulp Tangki 205 (set)">
  <input type="number" id="adhesive_standby" placeholder="Adhesive Standby (set)">
  <input type="number" id="adhesive_sisa" placeholder="Adhesive Sisa (set)">
  <input type="number" id="flavor_standby" placeholder="Flavor Standby (set)">
  <input type="number" id="flavor_sisa" placeholder="Flavor Sisa (set)">
  <input type="number" id="kalsium" placeholder="Kalsium Standby (set)">
  <input id="recycle" placeholder="Recycle (mis. 3 set × 20 kg)">
  <textarea id="catatan_preparation" placeholder="Catatan Preparation..."></textarea>

  <h3>FINISH GOOD</h3>
  <input type="number" id="mr" placeholder="Mother Roll (roll)">
  <input type="number" id="fg_berat" placeholder="Total Berat (kg)">
  <textarea id="catatan_finish" placeholder="Catatan Finish Good..."></textarea>

  <h3>CYLINDER</h3>
  <input id="pisau" placeholder="Pisau Nomor">
  <textarea id="catatan_cylinder" placeholder="Catatan Cylinder..."></textarea>

  <h3>SLITTING</h3>
  <input type="number" id="slit_mr" placeholder="Jumlah MR dipotong">
  <input type="number" id="reject_produksi" placeholder="Bobin Reject Produksi">
  <input type="number" id="reject_ncp" placeholder="Bobin Reject NCP">
  <input type="number" id="total_bobin_manual" placeholder="Total Bobin Manual">
  <textarea id="catatan_slitting" placeholder="Catatan Slitting..."></textarea>

  <button id="generateBtn" onclick="generateShift()">Tampilkan & Simpan</button>
  <div id="notif"></div>
  <pre id="output"></pre>
  <button id="waBtn" onclick="kirimWhatsApp()">Kirim WhatsApp</button>
  <button id="copyBtn" onclick="salinLaporan()">Salin</button>
</div>

<!-- 🔹 TAB 2: Line 2 & 3 -->
<div id="line2Tab" class="tabContent">
  <h2>Laporan Line 2 & 3</h2>
  <input type="date" id="tanggal2">
  <input id="shift2" placeholder="Shift">
  <input id="produk2" placeholder="Produk">
  <textarea id="catatan2" placeholder="Catatan Line 2"></textarea>
  <textarea id="catatan3" placeholder="Catatan Line 3"></textarea>

  <button onclick="generateLine23()">Tampilkan & Simpan</button>
  <pre id="output2"></pre>
</div>

<!-- 🔹 TAB 3: Monitoring -->
<div id="monitorTab" class="tabContent">
  <h2>Monitoring Semua Data</h2>
  <label>Filter tanggal:</label>
  <input type="date" id="monitorTanggal" onchange="renderMonitor()">
  <div id="monitorOutput"></div>
</div>

<script>
function openTab(tabId, elm) {
  document.querySelectorAll(".tabContent").forEach(tab => tab.style.display="none");
  document.getElementById(tabId).style.display="block";
  document.querySelectorAll(".tabBtn").forEach(btn => btn.classList.remove("active"));
  elm.classList.add("active");
}
function g(id){return document.getElementById(id).value.trim();}
function showNotif(pesan, sukses=true){
  const n=document.getElementById("notif");
  n.textContent=pesan; n.className=sukses?"sukses":"gagal"; n.style.display="block";
  setTimeout(()=>n.style.display="none",3000);
}
function updateShiftInput(){
  const s=document.getElementById("shiftSelect"), i=document.getElementById("shift");
  if(s.value==="lain"){i.style.display="block"; i.value="";} else {i.style.display="none"; i.value=s.value;}
}
function kirimWhatsApp(){const isi=document.getElementById("output").textContent;if(isi)window.open("https://wa.me/?text="+encodeURIComponent(isi),"_blank");}
function salinLaporan(){const isi=document.getElementById("output").textContent;if(isi)navigator.clipboard.writeText(isi).then(()=>showNotif("📋 Laporan disalin",true));}
</script>

<!-- 🔹 Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCReZ1Hs1p63Sq6DWODvwbKCgpVPUzVKQA",
  authDomain: "laporanharian-d689c.firebaseapp.com",
  databaseURL: "https://laporanharian-d689c-default-rtdb.firebaseio.com",
  projectId: "laporanharian-d689c",
  storageBucket: "laporanharian-d689c.appspot.com",
  messagingSenderId: "161606001787",
  appId: "1:161606001787:web:a2550a1abf208ce188aede",
  measurementId: "G-E9SL4RT4TB"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// 🔹 SHIFT
let dataShift={};
window.generateShift=function(){
  const shift=g("shift")||"-";
  const bobin_mr=parseInt(g("slit_mr"))||0;
  const total_bobin=bobin_mr*10;
  const reject=parseInt(g("reject_produksi"))||0;
  const reject_ncp=parseInt(g("reject_ncp"))||0;
  const bobin_oke=total_bobin-reject-reject_ncp;
  const bobin_oke_kg=bobin_oke*15;
  const totalManual=parseInt(g("total_bobin_manual"))||0;
  const totalManualKg=totalManual*15;
  const oee=(b obin_oke_kg/(10.2*1.09*0.22*480))*100;

  let hasil=`LAPORAN SHIFT ${shift}\nTanggal: ${g("tanggal")}\nProduk: ${g("produk")}\n\n`;
  hasil+=`GRINDING\n- PSA: ${g("psa")}\n- Mesh: ${g("mesh")}\n- Mix A: ${g("mix_a")}\n- Mix B: ${g("mix_b")}\n- Silo A: ${g("silo_a")}\n- Silo B: ${g("silo_b")}\n${g("catatan_grinding")}\n\n`;
  hasil+=`PREPARATION\n- Pulp203: ${g("pulp203")}\n- Pulp204: ${g("pulp204")}\n- Pulp205: ${g("pulp205")}\n- Adhesive Standby: ${g("adhesive_standby")}\n- Adhesive Sisa: ${g("adhesive_sisa")}\n- Flavor Standby: ${g("flavor_standby")}\n- Flavor Sisa: ${g("flavor_sisa")}\n- Kalsium: ${g("kalsium")}\n- Recycle: ${g("recycle")}\n${g("catatan_preparation")}\n\n`;
  hasil+=`FINISH GOOD\n- MR: ${g("mr")}\n- Berat: ${g("fg_berat")} kg\n${g("catatan_finish")}\n\n`;
  hasil+=`CYLINDER\n- Pisau: ${g("pisau")}\n${g("catatan_cylinder")}\n\n`;
  hasil+=`SLITTING\n- Potong: ${bobin_mr} MR = ${total_bobin} bobin\n- Reject Produksi: ${reject} bobin (${reject*15}kg)\n- Reject NCP: ${reject_ncp} bobin (${reject_ncp*15}kg)\n- Oke: ${bobin_oke} bobin (${bobin_oke_kg}kg)\n- Total Manual: ${totalManual} bobin (${totalManualKg}kg)\n${g("catatan_slitting")}\n\n`;
  hasil+=`OEE: ${oee.toFixed(2)}%\n`;

  document.getElementById("output").textContent=hasil;
  const tanggal=g("tanggal")||"tanpa_tanggal";
  const refDb=ref(db,"laporan_shift/"+tanggal); const newData=push(refDb);
  set(newData,{shift:shift,laporan:hasil,waktu:new Date().toISOString()})
  .then(()=>showNotif("✅ Laporan shift tersimpan",true))
  .catch(()=>showNotif("❌ Gagal simpan",false));
}
const refShift=ref(db,"laporan_shift");
onValue(refShift,(snap)=>{dataShift=snap.val()||{}; renderMonitor();});

// 🔹 LINE 2 & 3
let dataLine23={};
window.generateLine23=function(){
  let hasil=`LAPORAN LINE 2 & 3\nTanggal: ${g("tanggal2")}\nShift: ${g("shift2")}\nProduk: ${g("produk2")}\nCatatan Line2: ${g("catatan2")}\nCatatan Line3: ${g("catatan3")}`;
  document.getElementById("output2").textContent=hasil;
  const tanggal=g("tanggal2")||"tanpa_tanggal";
  const refDb=ref(db,"laporan_line2_3/"+tanggal); const newData=push(refDb);
  set(newData,{shift:g("shift2"),laporan:hasil,waktu:new Date().toISOString()});
}
const refLine23=ref(db,"laporan_line2_3");
onValue(refLine23,(snap)=>{dataLine23=snap.val()||{}; renderMonitor();});

// 🔹 MONITOR
function renderMonitor(){
  const fT=document.getElementById("monitorTanggal").value;
  const out=document.getElementById("monitorOutput"); out.innerHTML="";
  Object.keys(dataShift).forEach(tgl=>{
    if(fT&&tgl!==fT)return;
    Object.values(dataShift[tgl]).forEach(item=>{
      const d=document.createElement("details");
      d.innerHTML=`<summary>Shift | ${tgl} - ${item.shift}</summary><pre>${item.laporan}</pre>`;
      out.appendChild(d);
    });
  });
  Object.keys(dataLine23).forEach(tgl=>{
    if(fT&&tgl!==fT)return;
    Object.values(dataLine23[tgl]).forEach(item=>{
      const d=document.createElement("details");
      d.innerHTML=`<summary>Line 2&3 | ${tgl} - ${item.shift}</summary><pre>${item.laporan}</pre>`;
      out.appendChild(d);
    });
  });
}
</script>
</body>
  </html>
